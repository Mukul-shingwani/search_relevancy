<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Search Assortment — automotive / wax</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Fonts: Proxima Nova if installed, else Inter -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- DataTables + Buttons -->
  <link rel="stylesheet" href="https://cdn.datatables.net/v/bs5/dt-2.0.3/b-3.0.1/fh-4.0.1/r-3.0.1/datatables.min.css"/>

  <style>
    :root {
      --bg: #0f1220;
      --card: #141a2a;
      --card-2: #181e31;
      --text: #f3f6ff;     /* normal text = light */
      --text-dim: #b8c1d9;
      --border: #252c42;
      --brand: #7aa2ff;
      --brand-soft: #1a2340;
      --card-radius: 14px;
    }
    * { font-family: "Proxima Nova", Inter, "Segoe UI", Roboto, system-ui, -apple-system, Arial, sans-serif; }
    html, body { background: var(--bg); color: var(--text); }

    .page-header {
      background: radial-gradient(1200px 400px at 10% -10%, rgba(122,162,255,.25), transparent),
                  linear-gradient(90deg, var(--brand-soft), rgba(10,14,25,0.6));
      border-bottom: 1px solid var(--border);
    }
    .page-header h2 { font-weight: 700; letter-spacing:.2px; color: var(--text); }
    .muted { color: var(--text-dim); }

    .btn, .btn:focus, .btn:active { box-shadow:none; }
    .btn-outline-secondary { color: var(--text); border-color: var(--border); }
    .btn-outline-secondary:hover { background: var(--card-2); border-color: var(--border); }
    .btn-outline-primary { color: var(--text); border-color: var(--brand); }
    .btn-outline-primary:hover { background: rgba(122,162,255,.12); }

    .section-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--card-radius);
      box-shadow: 0 8px 24px rgba(0,0,0,.25);
      padding: 1rem 1.1rem 1.25rem 1.1rem;
      height: 100%;
      contain: content;
      color: var(--text);
    }
    .section-title { font-weight: 700; font-size: 1.05rem; margin-bottom:.6rem; color: var(--text); }

    /* Executive summary pills */
    .summary-pill {
      border-radius: 999px;
      padding:.7rem 1.1rem;
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border:1px solid var(--border);
      display:inline-flex; gap:.6rem; align-items:center;
      box-shadow: 0 6px 16px rgba(0,0,0,.25);
      margin:.3rem .6rem .3rem 0;
    }
    .summary-pill .label { color: var(--text-dim); font-size:.9rem; }
    .summary-pill .value { font-weight:700; color: var(--text); font-size:1.05rem; }

    /* DataTables: dark + light text everywhere */
    table.dataTable { table-layout: fixed; color: var(--text); }
    table.table {
      --bs-table-color: var(--text);
      --bs-table-bg: transparent;
      --bs-table-striped-color: var(--text);
      --bs-table-hover-color: var(--text);
      --bs-table-border-color: var(--border);
      --bs-table-striped-bg: rgba(255,255,255,0.06);
      --bs-table-hover-bg: rgba(255,255,255,0.08);
    }
    table.dataTable thead th {
      background: var(--card-2) !important;
      border-bottom: 1px solid var(--border) !important;
      color: var(--text) !important;
    }
    table.dataTable tbody td { vertical-align: top; border-color: var(--border); color: var(--text); }

    .dataTables_wrapper .dataTables_info,
    .dataTables_wrapper .dataTables_length label,
    .dataTables_wrapper .dataTables_filter label { color: var(--text-dim); }

    .dataTables_wrapper .dataTables_filter input,
    .dataTables_wrapper .dataTables_length select {
      background: var(--card-2);
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 10px;
    }
    .dataTables_wrapper .dataTables_filter input::placeholder { color: var(--text-dim); }

    .dataTables_wrapper .dataTables_paginate .paginate_button {
      color: var(--text) !important; border-color: var(--border) !important;
      background: transparent !important;
    }
    .dataTables_wrapper .dataTables_paginate .paginate_button.current {
      background: var(--brand-soft) !important; border-color: var(--border) !important; color: var(--text) !important;
    }

    a, a:visited { color: var(--brand); }
    a:hover { color: #aecdff; }

    /* Long text handling + toggles */
    .wrap-text { white-space: pre-wrap; line-height:1.35rem; color: var(--text); }
    .clamp-6 {
      display: -webkit-box;
      -webkit-line-clamp: 6;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    .cell-stack { display:flex; flex-direction:column; gap:.45rem; color: var(--text); }
    .toggle-more { font-size:.85rem; padding:0; color: var(--text-dim); }
    .toggle-more:hover { color: var(--text); }

    /* Actionables list (pills centered vertically) */
    .act {
      display:flex; gap:.7rem; align-items:center;       /* centered vertically */
      background: var(--card-2); border: 1px solid var(--border);
      border-radius: 12px; padding:.65rem .8rem; color: var(--text);
    }
    .act .tag {
      flex: 0 0 auto; font-size:.72rem; font-weight:700; text-transform:uppercase;
      letter-spacing:.04em; color: var(--brand);
      padding:.22rem .55rem; border:1px solid var(--brand); border-radius:999px;
      background: rgba(122,162,255,.08);
    }
    .act .txt { flex:1 1 auto; color: var(--text); }

    .footer-note { color: var(--text-dim); font-size:.85rem; }
  </style>
</head>

<body>
  <header class="page-header py-3">
    <div class="container">
      <div class="d-flex flex-wrap align-items-center justify-content-between">
        <div>
          <h2 class="mb-0">Search Assortment — automotive / wax</h2>
          <div class="muted">Category: <strong>automotive</strong> &nbsp;|&nbsp; Subtype: <strong>wax</strong></div>
        </div>
        <div class="text-end">
          <a class="btn btn-outline-secondary btn-sm" href="#" onclick="window.print()">Print</a>
        </div>
      </div>
    </div>
  </header>

  <main class="container my-4">

    <!-- Executive Summary -->
    <div class="section-card mb-4">
      <div class="d-flex align-items-center flex-wrap">
        <div class="summary-pill"><span class="label">Overall Score</span><span class="value" id="pill-score">—</span></div>
        <div class="summary-pill"><span class="label">Overall Search Hits</span><span class="value" id="pill-hits">—</span></div>
        <div class="summary-pill"><span class="label">Overall GMV Opportunity</span><span class="value" id="pill-gmv">—</span></div>
        <div class="ms-auto muted">Generated on 09 Sep 2025, 08:09 PM</div>
      </div>
    </div>

    <!-- Keyword level insights -->
    <div class="row g-4">
      <div class="col-lg-6">
        <div class="section-card">
          <div class="section-title">Keyword Insights — Generic</div>
          <table id="tbl-generic" class="table table-striped table-hover w-100"></table>
        </div>
      </div>
      <div class="col-lg-6">
        <div class="section-card">
          <div class="section-title">Keyword Insights — Branded</div>
          <table id="tbl-branded" class="table table-striped table-hover w-100"></table>
        </div>
      </div>
    </div>

    <!-- Detailed analysis -->
    <div class="section-card mt-4">
      <div class="d-flex justify-content-between align-items-center">
        <div class="section-title mb-0">Detailed Analysis</div>
        <div class="d-flex gap-2">
          <button id="btn-expand-all" class="btn btn-sm btn-outline-primary">Expand all</button>
          <button id="btn-collapse-all" class="btn btn-sm btn-outline-secondary">Collapse all</button>
        </div>
      </div>
      <p class="muted mb-2">Actionables per search term. Links open in a new tab.</p>
      <table id="tbl-detail" class="table table-striped table-hover w-100"></table>
    </div>

    <div class="my-4 footer-note">
      Data source: <code>noonbiml.mukul.search_assortment_final_v2</code>. Report for <strong>automotive × wax</strong>.
    </div>
  </main>

  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.datatables.net/v/bs5/dt-2.0.3/b-3.0.1/fh-4.0.1/r-3.0.1/datatables.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

  <script>
    const EXEC_SUMMARY = {"overall_score": 0.8, "overall_st_hits": 591, "overall_gmv_oppt": 109.68};
    const DATA_GENERIC = [{"search_term": "car wax polish", "performance": "Average (0.87)", "st_hits": 8, "e_gmv": 0, "st_gmv": 0.0}, {"search_term": "liquid wax", "performance": "Average (0.89)", "st_hits": 13, "e_gmv": 0, "st_gmv": 36.95}, {"search_term": "car wax", "performance": "Good (0.90)", "st_hits": 117, "e_gmv": 0, "st_gmv": 53.0}, {"search_term": "scratch remover", "performance": "Below Average (0.82)", "st_hits": 228, "e_gmv": 0, "st_gmv": 300.76}, {"search_term": "car wax spray", "performance": "Average (0.88)", "st_hits": 28, "e_gmv": 0, "st_gmv": 0.0}, {"search_term": "carnauba wax", "performance": "Good (0.91)", "st_hits": 7, "e_gmv": 0, "st_gmv": 0.0}, {"search_term": "spray wax", "performance": "Good (0.90)", "st_hits": 8, "e_gmv": 0, "st_gmv": 0.0}, {"search_term": "sword pro", "performance": "Poor (0.42)", "st_hits": 13, "e_gmv": 0, "st_gmv": 0.0}, {"search_term": "hybrid", "performance": "Poor (0.40)", "st_hits": 8, "e_gmv": 0, "st_gmv": 0.0}, {"search_term": "wax applicator", "performance": "Good (0.92)", "st_hits": 26, "e_gmv": 0, "st_gmv": 20.0}];
    const DATA_BRANDED = [{"search_term": "sonax wax", "performance": "Below Average (0.82)", "st_hits": 2, "e_gmv": 0, "st_gmv": 0.0}, {"search_term": "turtle wax", "performance": "Below Average (0.79)", "st_hits": 130, "e_gmv": 0, "st_gmv": 281.01}, {"search_term": "formula 1 wax", "performance": "Good (0.91)", "st_hits": 2, "e_gmv": 0, "st_gmv": 0.0}, {"search_term": "nanoskin wax", "performance": "Poor (0.62)", "st_hits": 0, "e_gmv": 0, "st_gmv": 0.0}, {"search_term": "3m wax", "performance": "Good (0.91)", "st_hits": 1, "e_gmv": 0, "st_gmv": 0.0}];
    const DATA_DETAIL  = [{"search_term": "sonax wax", "brand_actionable": "- Sonax appears prominently on both platforms; Noon lists 10 Sonax SKUs vs Amazon’s 8, showing stronger Sonax presence on Noon.  \n- Noon lacks non-Sonax branded waxes present on Amazon, limiting brand variety for \"sonax wax\" search.", "assortment_actionable": "- Noon ranks core Sonax wax products top but lacks some color-specific and combo variants found on Amazon.", "overall_perception": "- Noon’s first page is Sonax-focused and relevant, while Amazon offers broader Sonax variants plus complementary wax products, enhancing shopper choice.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=sonax%20wax&av=0&e[search-ae]", "amazon_plp_link": "https://www.amazon.ae/s?k=sonax+wax"}, {"search_term": "turtle wax", "brand_actionable": "- Turtle Wax appears once on Noon (rank 8), absent on Amazon’s top listings.  \n- Noon covers 1/3 top Amazon brands (Hybrid Solutions present on both).", "assortment_actionable": "- Noon’s top ranks mix generic waxes; Amazon offers larger pack sizes and bundles (e.g., 2-pack Wax & Dry).", "overall_perception": "- Noon’s first page shows limited Turtle Wax presence, mixing unrelated products; Amazon emphasizes relevant, branded, and feature-rich waxes.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=turtle%20wax&av=0&e[search-ae]", "amazon_plp_link": "https://www.amazon.ae/s?k=turtle+wax"}, {"search_term": "formula 1 wax", "brand_actionable": "- Formula 1 appears prominently on Noon (4 SKUs) and Amazon (1 SKU), but Noon shows stronger brand presence and frequency.  \n- Noon lacks other niche wax brands found on Amazon, e.g., specialized bike/car wax variants.", "assortment_actionable": "- Noon ranks multiple Formula 1 variants top but lacks Amazon’s broader feature range like fast wax and spray options.", "overall_perception": "- Noon’s first page emphasizes branded Formula 1 waxes, while Amazon offers more diverse, feature-rich, and specialized wax types enhancing shopper choice.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=formula%201%20wax&av=0&e[search-ae]", "amazon_plp_link": "https://www.amazon.ae/s?k=formula+1+wax"}, {"search_term": "nanoskin wax", "brand_actionable": "- Nanoskin appears prominently on Noon (3 SKUs top 5), absent on Amazon; Amazon lacks this key branded wax-related product.  \n- Noon misses broader wax brands like Fortify and Hybrid Solutions featured on Amazon, limiting brand variety.", "assortment_actionable": "- Noon ranks specialized Nanoskin prep tools top but lacks diverse wax types and pack sizes Amazon offers.", "overall_perception": "- Noon’s first page blends premium branded prep tools with less relevant compounds; Amazon leads with focused wax products and broader budget options.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=nanoskin%20wax&av=0&e[search-ae]", "amazon_plp_link": "https://www.amazon.ae/s?k=nanoskin+wax"}, {"search_term": "3m wax", "brand_actionable": "- Noon features 3M prominently with 9 SKUs vs Amazon’s 3, showing strong brand presence.  \n- Amazon includes additional niche wax brands absent on Noon, limiting brand diversity.", "assortment_actionable": "- Noon ranks multiple 3M wax variants top but lacks smaller pack options seen on Amazon.", "overall_perception": "- Noon’s first page is 3M-focused and premium; Amazon offers broader brand variety, aiding wider shopper appeal.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=3m%20wax&av=0&e[search-ae]", "amazon_plp_link": "https://www.amazon.ae/s?k=3m+wax"}, {"search_term": "car wax polish", "brand_actionable": "- Noon covers 3 key carnauba wax brands; Amazon includes 5, adding Simoniz and Turtle Wax missing on Noon.  \n- Noon lacks premium brand presence share (e.g., Turtle Wax, Simoniz) prominent on Amazon’s first page.", "assortment_actionable": "- Amazon ranks diverse wax types (sprays, pastes, liquids) top; Noon’s top slots favor generic or fewer format variants.", "overall_perception": "- Noon’s first page mixes generic and scratch removers, Amazon leads with premium, focused car wax polish products enhancing trust.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=car%20wax%20polish&av=0&e[search-ae]", "amazon_plp_link": "https://www.amazon.ae/s?k=car+wax+polish"}, {"search_term": "liquid wax", "brand_actionable": "- Noon covers 3 key carnauba wax brands; Amazon includes premium brands like 3M, Meguiar's absent on Noon.  \n- Noon lacks Turtle Wax prominence (0% share) vs Amazon’s 30% share in top 10.", "assortment_actionable": "- Noon ranks fewer premium liquid wax SKUs top; Amazon features diverse sizes, ceramic and graphene variants prominently.", "overall_perception": "- Noon’s first page mixes relevant liquid wax with unrelated wax types; Amazon leads with focused, premium liquid wax offerings.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=liquid%20wax&av=0&e[search-ae]", "amazon_plp_link": "https://www.amazon.ae/s?k=liquid+wax"}, {"search_term": "car wax", "brand_actionable": "- Noon covers 3 top Amazon brands (Formula 1, Herios, Super Hard Shell); Turtle Wax and SONAX missing on Noon.  \n- Amazon shows stronger Turtle Wax presence (3 SKUs) vs none on Noon.", "assortment_actionable": "- Noon ranks generic \"Car Wax\" titles top; Amazon leads with branded, feature-rich SKUs and diverse formats (paste, liquid, spray).", "overall_perception": "- Noon’s first page mixes budget generics and repair kits; Amazon emphasizes premium, branded car waxes enhancing shopper trust.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=car%20wax&av=0&e[search-ae]", "amazon_plp_link": "https://www.amazon.ae/s?k=car+wax"}, {"search_term": "scratch remover", "brand_actionable": "- Noon lacks major brands like Meguiar's and Turtle Wax, which dominate Amazon's top ranks.  \n- Noon covers mostly generic or lesser-known brands; Amazon shows 4 top brands vs Noon’s none.", "assortment_actionable": "- Amazon ranks branded, feature-rich scratch removers top; Noon’s top slots show generic kits and pens with less brand trust.", "overall_perception": "- Noon’s first page is budget-focused, generic products; Amazon leads with premium, branded, and highly relevant scratch removers enhancing shopper confidence.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=scratch%20remover&av=0&e[search-ae]", "amazon_plp_link": "https://www.amazon.ae/s?k=scratch+remover"}, {"search_term": "car wax spray", "brand_actionable": "- Noon covers 3 key brands (Speed Wax, Shine Armor, Hybrid Solutions) vs Amazon’s 6, missing Turtle Wax and Meguiar’s presence.  \n- Turtle Wax appears prominently on Amazon (4 listings), absent on Noon, reducing brand variety for car wax spray.", "assortment_actionable": "- Noon lacks multipacks and larger size variants that Amazon ranks top 3, limiting depth and shopper choice.", "overall_perception": "- Noon’s first page mixes budget and niche brands; Amazon leads with premium, widely recognized brands boosting shopper trust.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=car%20wax%20spray&av=0&e[search-ae]", "amazon_plp_link": "https://www.amazon.ae/s?k=car+wax+spray"}, {"search_term": "carnauba wax", "brand_actionable": "- Noon covers 3/6 top Amazon carnauba wax brands (Herios, Formula 1, Speed Wax); missing Simoniz, Turtle Wax, Meguiar’s presence.  \n- Meguiar’s appears 0x on Noon vs 3x on Amazon, limiting premium brand appeal.", "assortment_actionable": "- Noon ranks mostly generic or lesser-known brands top; lacks Meguiar’s and Simoniz premium variants in visible slots.", "overall_perception": "- Noon’s first page mixes budget and generic items; Amazon leads with premium, branded, and highly relevant carnauba wax products.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=carnauba%20wax&av=0&e[search-ae]", "amazon_plp_link": "https://www.amazon.ae/s?k=carnauba+wax"}, {"search_term": "spray wax", "brand_actionable": "- Noon covers 3/7 top Amazon brands (43%), missing Meguiar's and Griot's Garage presence.  \n- Key brands Turtle Wax and Shine Armor appear on both but Noon ranks Shine Armor higher.", "assortment_actionable": "- Noon lacks multipacks and larger sizes; Amazon ranks multipacks and premium variants top 3.", "overall_perception": "- Noon’s first page mixes premium and budget but lacks top-tier, feature-rich SKUs Amazon prominently shows.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=spray%20wax&av=0&e[search-ae]", "amazon_plp_link": "https://www.amazon.ae/s?k=spray+wax"}, {"search_term": "sword pro", "brand_actionable": "- Sword Pro brand dominates Amazon with 100% presence; Noon has zero Sword Pro automotive wax products, only unrelated phone cases.  \n- Noon lacks any Sword Pro branded wax or automotive care items, missing key brand relevance for this keyword.", "assortment_actionable": "- Amazon ranks multiple Sword Pro wax and care variants top; Noon shows no relevant wax SKUs in top positions, only phone cases.", "overall_perception": "- Noon’s first page confuses shoppers with unrelated phone cases; Amazon leads with relevant, branded Sword Pro automotive wax products.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=sword%20pro&av=0&e[search-ae]", "amazon_plp_link": "https://www.amazon.ae/s?k=sword+pro"}, {"search_term": "hybrid", "brand_actionable": "- Noon lacks Turtle Wax and Meguiar’s hybrid wax brands, which dominate Amazon’s top results.  \n- Noon covers 0/4 top Amazon hybrid wax brands (0%).", "assortment_actionable": "- Noon ranks no automotive wax products top; Amazon leads with multiple Turtle Wax hybrid wax variants in top 5.", "overall_perception": "- Noon’s first page shows mostly irrelevant hybrid items; Amazon features premium, relevant hybrid automotive waxes, boosting shopper trust.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=hybrid&av=0&e[search-ae]", "amazon_plp_link": "https://www.amazon.ae/s?k=hybrid"}, {"search_term": "wax applicator", "brand_actionable": "- Noon lacks key car wax applicator brands like FONAROLL and Sonax present on Amazon.  \n- Noon covers mostly generic/unbranded wax applicators; Amazon shows 3 recognized brands in top 10.", "assortment_actionable": "- Amazon ranks branded microfiber car wax applicator pads top; Noon’s top slots favor generic wooden spatulas and mixed-use applicators.", "overall_perception": "- Noon’s first page mixes car and hair removal wax applicators, reducing relevance; Amazon prioritizes car-specific, branded wax applicators building shopper trust.", "noon_plp_link": "https://www.noon.com/uae-en/search/?q=wax%20applicator&av=0&e[search-ae]", "amazon_plp_link": "https://www.amazon.ae/s?k=wax+applicator"}];

    const fmtInt = (v) => (v === null || v === undefined || isNaN(v)) ? "—" : Number(v).toLocaleString();
    const fmtNum = (v) => (v === null || v === undefined || isNaN(v)) ? "—" : Number(v).toLocaleString(undefined, {"minimumFractionDigits":0,"maximumFractionDigits":2});
    const toLink = (url, label) => {
      if (!url || typeof url !== 'string') return '';
      const safe = url.startsWith('http') ? url : null;
      return safe ? `<a href="${safe}" target="_blank" rel="noopener">${label || 'Open'}</a>` : '';
    };
    const escapeHTML = (s) => String(s ?? '').replace(/[&<>"']/g, (m) => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m]);

    // Single "Actionables" cell from 3 fields
    const makeActionablesCell = (row) => {
      const items = [];
      if (row.brand_actionable) items.push(`<div class="act"><div class="tag">Brand</div><div class="txt wrap-text">${escapeHTML(row.brand_actionable)}</div></div>`);
      if (row.assortment_actionable) items.push(`<div class="act"><div class="tag">Assortment</div><div class="txt wrap-text">${escapeHTML(row.assortment_actionable)}</div></div>`);
      if (row.overall_perception) items.push(`<div class="act"><div class="tag">Perception</div><div class="txt wrap-text">${escapeHTML(row.overall_perception)}</div></div>`);

      const content = items.join('');
      const long = content.length > 300 || (content.match(/\n/g)||[]).length > 6;
      const btn  = long ? `<a href="#" class="toggle-more">Show more</a>` : '';
      return `<div class="cell-stack"><div class="wrap-text clamp-6">${content}</div>${btn}</div>`;
    };

    document.addEventListener('DOMContentLoaded', () => {
      // Executive summary values
      document.getElementById('pill-score').textContent = EXEC_SUMMARY.overall_score ?? "—";
      document.getElementById('pill-hits').textContent  = fmtInt(EXEC_SUMMARY.overall_st_hits);
      document.getElementById('pill-gmv').textContent   = fmtNum(EXEC_SUMMARY.overall_gmv_oppt);

      // Generic table
      $('#tbl-generic').DataTable({
        data: DATA_GENERIC,
        columns: [
          {title:'Search Term', data:'search_term'},
          {title:'Performance', data:'performance'},
          {title:'Search Hits', data:'st_hits', render:(d)=>fmtInt(d), className:'text-end'},
          {title:'Search Term GMV', data:'st_gmv', render:(d)=>fmtNum(d), className:'text-end'}
        ],
        order: [[2,'desc']],
        responsive: true,
        fixedHeader: false,
        deferRender: true,
        autoWidth: false,
        pageLength: 10,
        lengthMenu: [10,25,50,100],
        dom:'Bfrtip',
        buttons:['pageLength','copy','csv']
      });

      // Branded table
      $('#tbl-branded').DataTable({
        data: DATA_BRANDED,
        columns: [
          {title:'Search Term', data:'search_term'},
          {title:'Performance', data:'performance'},
          {title:'Search Hits', data:'st_hits', render:(d)=>fmtInt(d), className:'text-end'},
          {title:'Search Term GMV', data:'st_gmv', render:(d)=>fmtNum(d), className:'text-end'}
        ],
        order: [[2,'desc']],
        responsive: true,
        fixedHeader: false,
        deferRender: true,
        autoWidth: false,
        pageLength: 10,
        lengthMenu: [10,25,50,100],
        dom:'Bfrtip',
        buttons:['pageLength','copy','csv']
      });

      // Detailed Analysis
      const dtDetail = $('#tbl-detail').DataTable({
        data: DATA_DETAIL,
        columns: [
          {title:'Search Term', data:'search_term', width:'18%'},
          {title:'Actionables', data:null, width:'56%', render:(d,type,row)=>makeActionablesCell(row)},
          {title:'Noon PLP', data:'noon_plp_link', width:'13%', render:(d)=>toLink(d,'Noon PLP')},
          {title:'Amazon PLP', data:'amazon_plp_link', width:'13%', render:(d)=>toLink(d,'Amazon PLP')}
        ],
        order: [[0,'asc']],
        responsive: false,
        fixedHeader: false,
        deferRender: true,
        autoWidth: false,
        pageLength: 10,
        lengthMenu: [10,25,50,100],
        dom:'Bfrtip',
        buttons:['pageLength','copy','csv']
      });

      // Per-cell toggle
      $('#tbl-detail').on('click', 'a.toggle-more', function(e){
        e.preventDefault();
        const wrap = this.closest('td').querySelector('.wrap-text');
        if (wrap.classList.contains('clamp-6')) {
          wrap.classList.remove('clamp-6');
          this.textContent = 'Show less';
        } else {
          wrap.classList.add('clamp-6');
          this.textContent = 'Show more';
        }
      });

      // Expand/collapse all
      document.getElementById('btn-expand-all').addEventListener('click', () => {
        document.querySelectorAll('#tbl-detail .wrap-text').forEach(el => el.classList.remove('clamp-6'));
        document.querySelectorAll('#tbl-detail a.toggle-more').forEach(a => a.textContent='Show less');
      });
      document.getElementById('btn-collapse-all').addEventListener('click', () => {
        document.querySelectorAll('#tbl-detail .wrap-text').forEach(el => el.classList.add('clamp-6'));
        document.querySelectorAll('#tbl-detail a.toggle-more').forEach(a => a.textContent='Show more');
      });
    });
  </script>
</body>
</html>
